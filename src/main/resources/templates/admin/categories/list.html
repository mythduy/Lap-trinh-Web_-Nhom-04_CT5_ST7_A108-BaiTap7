<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout.html}" lang="vi">
<head>
<meta charset="UTF-8">
<title>Danh sách Category</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
</head>
<body layout:fragment="content">
	<div class="container mt-4">

		<div class="d-flex justify-content-between align-items-center mb-3">
			<h2>Danh sách Category</h2>
			<a th:href="@{/admin/categories/add}" class="btn btn-primary">➕
				Thêm mới</a>
		</div>

		<!-- Ô tìm kiếm realtime -->
		<div class="row mb-3">
			<div class="col-md-4">
				<input type="text" id="searchInput" class="form-control"
					placeholder="Nhập tên category để tìm..." />
			</div>
		</div>

		<!-- Bảng danh sách -->
		<table class="table table-striped table-hover">
			<thead class="table-dark">
				<tr>
					<th>ID</th>
					<th>Tên Category</th>
					<th>Ảnh</th>
					<th>Hành động</th>
				</tr>
			</thead>
			<tbody id="categoryTableBody">
				<tr th:each="c : ${categories}">
					<td th:text="${c.id}"></td>
					<td th:text="${c.categoryName}"></td>
					<td><img th:if="${c.images != null}"
						th:src="@{'/uploads/category/' + ${c.images}}" width="100"
						class="img-thumbnail" /></td>
					<td><a th:href="@{'/admin/categories/edit/' + ${c.id}}"
						class="btn btn-sm btn-warning">✏️ Sửa</a> <a
						th:href="@{'/admin/categories/delete/' + ${c.id}}"
						class="btn btn-sm btn-danger"
						onclick="return confirm('Bạn có chắc muốn xóa?')">🗑️ Xóa</a></td>
				</tr>
			</tbody>
		</table>

		<!-- Thông báo -->
		<div th:if="${message != null}" class="alert alert-success">
			<span th:text="${message}"></span>
		</div>
	</div>

	<!-- JS để search realtime -->
	<script>
document.getElementById("searchInput").addEventListener("keyup", function() {
    const query = this.value;

    fetch("/admin/categories/search?name=" + query)
        .then(response => response.json())
        .then(data => {
            const tbody = document.getElementById("categoryTableBody");
            tbody.innerHTML = ""; // xoá bảng cũ

            data.forEach(c => {
                const row = `
                    <tr>
                        <td>${c.id}</td>
                        <td>${c.categoryName}</td>
                        <td>
                            ${c.images ? `<img src="/uploads/category/${c.images}" width="100" class="img-thumbnail"/>` : ""}
                        </td>
                        <td>
                            <a href="/admin/categories/edit/${c.id}" class="btn btn-sm btn-warning">✏️ Sửa</a>
                            <a href="/admin/categories/delete/${c.id}" class="btn btn-sm btn-danger"
                               onclick="return confirm('Bạn có chắc muốn xóa?')">🗑️ Xóa</a>
                        </td>
                    </tr>`;
                tbody.innerHTML += row;
            });
        });
});
</script>

</body>
</html>